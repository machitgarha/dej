#!/bin/sh

# Don't move or edit this file manually!
# SOURCE
src="./"

# Check if source directory exists
if [ ! -d "$src" ]; then
    echo "Cannot find source directory. Try reinstalling Dej."
    exit
fi
cd $src

# Prints a message with a new line at end
printfl () {
    printf "$1\n"
}

# Helps PHP file path to output helps
helpHandler="src/help.php"

# Errors while entering commands
moreInfo="Try 'dej help' for more information."

badUsageError=\
"Bad usage.
$moreInfo"

# Show help if no argument supplied
if [ $# -eq 0 ]; then
    php $helpHandler "help"

# One or more arguments
else
    # Check for the command
    case $1 in

        # Needing help
        help|-h|--help)
            # General help
            if [ $# -eq 1 ]; then
                php $helpHandler "help"
            # Specific help 
            else
                php $helpHandler $2
            fi
            ;;

        # Changing or wanting Dej status
        start|stop|status|restart)
            if [ $# -eq 1 ]; then
                sh src/php.sh $1
            else
                printfl "$badUsageError"
            fi
            ;;

        # Update or uninstall Dej
        update|uninstall)
            sh $1.sh
            ;;

        # Dej configuration
        config)
            case $# in
                2)
                    case $2 in
                        # List of available fields
                        list)
                            php $helpHandler "config-list"
                            ;;
                        # Creating the configuration file or validating it
                        create|check)
                            sh src/php.sh $2
                            ;;
                        *)
                            printfl "$badUsageError"
                            ;;
                    esac
                    ;;
                # Changing a configuration
                3)
                    sh src/php.sh config $2 $3
                    ;;
                *)
                    printfl "$badUsageError"
                    ;;
            esac
            ;;

        # Unknown command
        *)
            printfl "Unknown command '$1'."
            printfl "$moreInfo"
            ;;
    esac
fi